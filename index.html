<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>ॐ GAROM INVESTMENTS - (INDIA)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <style>
    /* ===== ROOT COLORS & VARIABLES ===== */
    :root {
      --primary: #ff4d00;
      --secondary: #ffae00;
      --success: #a1a1a1;
      --danger: #e33232;
      --card-shadow: 0 4px 6px rgba(0,0,0,0.05);
    }

    /* ===== GLOBAL STYLES ===== */
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Inter', sans-serif; background: #000; color: #fff; line-height: 1.6; }
    .container { max-width: 1400px; margin: 0 auto; padding: 20px; }

    /* ===== HEADER ===== */
    header {
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      color: #fff;
      padding: 20px 0;
      border-radius: 12px;
      margin-bottom: 12px;
      box-shadow: var(--card-shadow);
    }
    .header-content { display: flex; justify-content: space-between; align-items: center; }
    .logo { font-size: 1.8rem; font-weight: 700; }
    .toolbar { display: flex; gap: 10px; align-items: center; }
    .btn { background: #2a2a2a; color: #fff; border: 1px solid #333; border-radius: 8px; padding: 8px 12px; cursor: pointer; }
    .btn:hover { background: #333; transform: translateY(-2px); }
    .date { color: #eee; font-size: 0.95rem; }

    /* ===== STATUS MESSAGE ===== */
    .status { margin: 10px 0 16px; font-size: 0.95rem; color: #bbb; }
    .status.success { color: #31c920; }

    /* ===== PORTFOLIO SUMMARY CARDS ===== */
    .portfolio-summary { background: #1a1a1a; border-radius: 12px; padding: 22px; box-shadow: var(--card-shadow); margin-bottom: 20px; }
    .summary-title { font-size: 1.5rem; margin-bottom: 14px; color: var(--success); }
    .summary-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 14px; }
    .summary-card { background: #2a2a2a; border-radius: 10px; padding: 16px; border-left: 4px solid var(--primary); }
    .summary-card:hover { transform: translateY(-5px); box-shadow: 0 10px 20px rgba(0,0,0,0.3); }
    .summary-card h3 { font-size: 0.9rem; color: #aaa; margin-bottom: 6px; }
    .summary-card .value { font-size: 1.8rem; font-weight: 700; margin-bottom: 4px; }
    .positive { color: #4cc9f0; }

    /* ===== CHART PANELS ===== */
    .panel { background: #1a1a1a; border-radius: 12px; padding: 18px; box-shadow: var(--card-shadow); margin-bottom: 20px; }
    .panel h3 { font-size: 1.1rem; margin-bottom: 8px; color: #ddd; }
    .chart-wrap { position: relative; height: 340px; }
    #allocDonutChart { filter: drop-shadow(0 0 20px rgba(61,61,61,0.3)); }

    /* ===== TABLE STYLES ===== */
    .portfolio-table { background: #1a1a1a; border-radius: 12px; overflow: hidden; box-shadow: var(--card-shadow); margin-bottom: 20px; }
    .table-header { background: linear-gradient(135deg, var(--secondary), var(--primary)); color: #fff; padding: 14px 18px; font-weight: 600; }
    .table-container { overflow-x: auto; }
    table { width: 100%; border-collapse: collapse; }
    th { text-align: left; padding: 12px 16px; font-weight: 600; color: #fff; background: rgba(255,255,255,0.1); cursor: pointer; }
    th:hover { background: rgba(255,255,255,0.15); }
    /* Sorting indicators (↑↓) */
    th.sortable::after { content: '⇅'; margin-left: 8px; opacity: 0.5; }
    th.sort-asc::after { content: '↑'; opacity: 1; color: #31c920; }
    th.sort-desc::after { content: '↓'; opacity: 1; color: #31c920; }
    td { padding: 12px 16px; border-bottom: 1px solid #333; font-size: 0.9rem; }
    tr:last-child td { border-bottom: none; }
    tr:hover { background-color: rgba(67,97,238,0.1); }
    .stock-symbol { font-weight: 700; color: var(--success); }
    .positive-return { color: #31c920; font-weight: 600; }
    .negative-return { color: var(--danger); font-weight: 600; }
    .suspended { color: #f9c74f; font-style: italic; }

    /* ===== FOOTER ===== */
    .footer { text-align: center; padding: 16px; color: #aaa; font-size: 0.9rem; }

    /* ===== MOBILE RESPONSIVE ===== */
    @media (max-width: 768px) {
      .header-content { flex-direction: column; gap: 12px; }
      .summary-grid { grid-template-columns: 1fr; }
      .chart-wrap { height: 220px; }
    }

    /* ===== PASSWORD GATE ===== */
    #gateOverlay { position: fixed; inset: 0; background: #0b0b0f; display: grid; place-items: center; z-index: 9999; }
    .gate-card { width: min(92vw, 420px); background: #141419; border: 1px solid #222; border-radius: 14px; padding: 22px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); color: #fff; }
    .gate-card h2 { margin-bottom: 10px; font-size: 1.25rem; }
    .gate-card p { margin-bottom: 14px; color: #bdbdbd; }
    .gate-row { display: flex; gap: 10px; }
    .gate-row input { flex: 1; padding: 12px; border-radius: 10px; border: 1px solid #2a2a2a; background: #0f0f14; color: #fff; outline: none; }
    .gate-row button { padding: 12px 14px; border-radius: 10px; border: 1px solid #333; background: #2a2a2a; color: #fff; cursor: pointer; font-weight: 600; }
    .shake { animation: shake 180ms linear 0s 2; }
    @keyframes shake { 0%{transform:translateX(0)} 25%{transform:translateX(-6px)} 50%{transform:translateX(6px)} 75%{transform:translateX(-4px)} 100%{transform:translateX(0)} }
  </style>
</head>
<body>
  <!-- ===== PASSWORD GATE ===== -->
  <div id="gateOverlay" aria-modal="true" role="dialog">
    <div class="gate-card" id="gateCard">
      <h2>PRIVATE ACCESS ONLY</h2>
      <p>Enter password to proceed.</p>
      <div class="gate-row">
        <input id="gateInput" type="password" placeholder="Passphrase" autocomplete="off" />
        <button id="gateBtn">Enter</button>
      </div>
    </div>
  </div>

  <!-- ===== MAIN APP ===== -->
  <div class="container">
    <!-- Header -->
    <header>
      <div class="header-content">
        <div class="logo">ॐ GAROM INVESTMENTS - (INDIA)</div>
        <div class="toolbar">
          <button id="refreshBtn" class="btn">Refresh now</button>
          <div class="date">Updated: <span id="updatedTime">—</span></div>
        </div>
      </div>
    </header>

    <div id="status" class="status">Initializing…</div>

    <!-- Portfolio Summary Cards & Donut Chart -->
    <div class="portfolio-summary">
      <h2 class="summary-title">Portfolio Overview</h2>
      <div class="summary-grid">
        <div class="summary-card">
          <h3>Total Value</h3>
          <div class="value" id="totalValue">₹0.00</div>
          <div class="positive" id="totalValueNote">+₹0.00</div>
        </div>
        <div class="summary-card">
          <h3>Total Invested</h3>
          <div class="value" id="totalInvested">₹0.00</div>
        </div>
        <div class="summary-card">
          <h3>Return</h3>
          <div class="value" id="returnAmount">₹0.00</div>
          <div class="positive" id="returnPercentage">+0.00%</div>
        </div>
        <div class="summary-card">
          <h3>Average Return (%)</h3>
          <div class="value" id="averageReturn">0.00%</div>
        </div>
        <div class="summary-card">
          <h3>Active Positions</h3>
          <div class="value" id="positionsCount">26</div>
        </div>
      </div>
      <div class="panel" style="margin-top: 12px;">
        <h3>Allocation by Holding</h3>
        <div class="chart-wrap">
          <canvas id="allocDonutChart"></canvas>
        </div>
      </div>
    </div>

    <!-- Bar Chart -->
    <div class="panel">
      <h3>Overall Return by Holding</h3>
      <div class="chart-wrap">
        <canvas id="returnBarChart"></canvas>
      </div>
    </div>

    <!-- Sortable Table -->
    <div class="portfolio-table">
      <div class="table-header">
        <div>Holdings • Click column headers to sort</div>
      </div>
      <div class="table-container">
        <table id="portfolioTable">
          <thead>
            <tr>
              <th class="sortable" data-column="0" data-type="text">Symbol</th>
              <th class="sortable" data-column="1" data-type="number">Price</th>
              <th class="sortable" data-column="2" data-type="number">1D Return</th>
              <th class="sortable" data-column="3" data-type="number">Current Value</th>
              <th class="sortable" data-column="4" data-type="number">Overall Return</th>
              <th class="sortable" data-column="5" data-type="number">Total Invested</th>
              <th class="sortable" data-column="6" data-type="number">Avg Cost</th>
              <th class="sortable" data-column="7" data-type="number">Quantity</th>
            </tr>
          </thead>
          <tbody id="tbody"></tbody>
        </table>
      </div>
    </div>

    <div class="footer">
      <p>Portfolio performance data • Personal use • N & G Moorjani</p>
    </div>
  </div>

  <script>
    // ===== CONFIG ===== 
    const REFRESH_MS = 120000; // Refresh every 2 minutes
    const PASSPHRASE = "2104";

    // ===== STOCK DATA ===== 
    // Special tickers for stocks that need custom formatting
    const TICKER_MAP = { 'DANISH': 'DANISH-SM.NS' };
    
    // Hardcoded prices for suspended stocks
    const HARDCODED_PRICES = {
      'BINNY': { price: 145.50, change: 0, changePct: 0, note: 'Trading Suspended' }
    };

    // Your portfolio
    const PORTFOLIO = [
      {symbol:"ABMKNO",avgCost:306.07,qty:1377},
      {symbol:"APARINDS",avgCost:9663.04,qty:109},
      {symbol:"AZAD",avgCost:1571.61,qty:3393},
      {symbol:"AZTEC",avgCost:98.51,qty:9000},
      {symbol:"BATLIBOI",avgCost:182.51,qty:4797},
      {symbol:"BCLIND",avgCost:46.15,qty:7614},
      {symbol:"BETA",avgCost:1914.98,qty:155},
      {symbol:"BINNY",avgCost:157.71,qty:26836},
      {symbol:"BBOX",avgCost:279.41,qty:2052},
      {symbol:"BLS",avgCost:400.2,qty:3240},
      {symbol:"COSMICCRF",avgCost:1313.69,qty:9200},
      {symbol:"DANISH",avgCost:967,qty:3600},
      {symbol:"EIEL",avgCost:284.9,qty:7974},
      {symbol:"FRONTSP",avgCost:743.72,qty:3949},
      {symbol:"HMEML",avgCost:74.33,qty:25600},
      {symbol:"KLBRENG-B",avgCost:374.18,qty:50940},
      {symbol:"KMEW",avgCost:451.2,qty:44109},
      {symbol:"KONSTELEC",avgCost:146.10,qty:30000},
      {symbol:"MACPOWER",avgCost:1056.28,qty:2862},
      {symbol:"MARKSANS",avgCost:257.18,qty:504},
      {symbol:"PENIND",avgCost:166.76,qty:17082},
      {symbol:"SHARDAMOTR",avgCost:434.66,qty:999},
      {symbol:"SHIVALIK",avgCost:624.84,qty:594},
      {symbol:"SGLTL",avgCost:177.14,qty:62820},
      {symbol:"SUMEETINDS",avgCost:19.04,qty:56520},
      {symbol:"TASTYBITE",avgCost:10633.68,qty:59}
    ];

    // Colors for chart segments
    const SYMBOL_COLORS = {
      ABMKNO:'#FF5252',APARINDS:'#40C4FF',AZAD:'#00C853',AZTEC:'#7C4DFF',
      BATLIBOI:'#18FFFF',BCLIND:'#FFB300',BETA:'#FF6E40',BINNY:'#E91E63',
      BBOX:'#9C27B0',BLS:'#3F51B5',COSMICCRF:'#03A9F4',DANISH:'#00BCD4',
      EIEL:'#009688',FRONTSP:'#4CAF50',HMEML:'#8BC34A','KLBRENG-B':'#CDDC39',
      KMEW:'#FFEB3B',KONSTELEC:'#FFC107',MACPOWER:'#FF9800',MARKSANS:'#FF5722',
      PENIND:'#795548',SHARDAMOTR:'#607D8B',SHIVALIK:'#F06292',SGLTL:'#BA68C8',
      SUMEETINDS:'#9575CD',TASTYBITE:'#7986CB'
    };

    // ===== DOM ELEMENTS ===== 
    const statusEl = document.getElementById("status");
    const updatedTimeEl = document.getElementById("updatedTime");
    const refreshBtn = document.getElementById("refreshBtn");

    // ===== UTILITY FUNCTIONS ===== 
    function setStatus(msg, type='') { statusEl.textContent = msg; statusEl.className = `status ${type}`; }
    function fmtMoney(n) { return '₹' + (Number(n)||0).toLocaleString('en-IN', {minimumFractionDigits:2, maximumFractionDigits:2}); }
    function fmtPct(n) { return (n>=0?'+':'') + (Number(n)||0).toFixed(2) + '%'; }
    function fmtSignedMoney(n) { return (n>=0?'+':'-') + fmtMoney(Math.abs(n)); }
    function parseMoney(text) { return parseFloat(String(text||'0').replace(/[^0-9.-]+/g,'')); }

    // ===== PASSWORD GATE ===== 
    function gateOk() {
      try {
        const raw = sessionStorage.getItem("gate_ok_v1");
        if(!raw) return false;
        const {ok, t} = JSON.parse(raw);
        return ok && (Date.now() - t) < 6*60*60*1000;
      } catch { return false; }
    }
    
    document.getElementById("gateBtn").addEventListener("click", () => {
      if(document.getElementById("gateInput").value.trim() === PASSPHRASE) {
        sessionStorage.setItem("gate_ok_v1", JSON.stringify({ok:true, t:Date.now()}));
        document.getElementById("gateOverlay").style.display = "none";
      } else {
        const c = document.getElementById("gateCard");
        c.classList.remove("shake");
        void c.offsetWidth;
        c.classList.add("shake");
      }
    });
    
    document.getElementById("gateInput").addEventListener("keydown", (e) => {
      if(e.key === "Enter") document.getElementById("gateBtn").click();
    });

    if(gateOk()) document.getElementById("gateOverlay").style.display = "none";

    // ===== TABLE INITIALIZATION ===== 
    function initializeTable() {
      const tbody = document.getElementById('tbody');
      tbody.innerHTML = '';
      PORTFOLIO.forEach(stock => {
        const invested = stock.avgCost * stock.qty;
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td class="stock-symbol">${stock.symbol}</td>
          <td>—</td><td>—</td><td>—</td><td>—</td>
          <td>${fmtMoney(invested)}</td>
          <td>${fmtMoney(stock.avgCost)}</td>
          <td>${stock.qty.toLocaleString('en-IN')}</td>
        `;
        tbody.appendChild(tr);
      });
      initializeTableSort();
    }

    // ===== TABLE SORTING ===== 
    let currentSort = {column: null, direction: 'asc'};
    
    function initializeTableSort() {
      document.querySelectorAll('#portfolioTable th.sortable').forEach(header => {
        header.addEventListener('click', () => {
          const column = parseInt(header.dataset.column);
          const type = header.dataset.type;
          if(currentSort.column === column) {
            currentSort.direction = currentSort.direction === 'asc' ? 'desc' : 'asc';
          } else {
            currentSort.column = column;
            currentSort.direction = 'asc';
          }
          sortTable(column, type, currentSort.direction);
          document.querySelectorAll('#portfolioTable th.sortable').forEach(th => th.classList.remove('sort-asc', 'sort-desc'));
          header.classList.add(currentSort.direction === 'asc' ? 'sort-asc' : 'sort-desc');
        });
      });
    }
    
    function sortTable(columnIndex, type, direction) {
      const tbody = document.getElementById('tbody');
      const rows = Array.from(tbody.querySelectorAll('tr'));
      rows.sort((a, b) => {
        let aVal = a.cells[columnIndex].textContent;
        let bVal = b.cells[columnIndex].textContent;
        if(type === 'number') {
          aVal = parseMoney(aVal);
          bVal = parseMoney(bVal);
          return direction === 'asc' ? aVal - bVal : bVal - aVal;
        } else {
          return direction === 'asc' ? aVal.localeCompare(bVal) : bVal.localeCompare(aVal);
        }
      });
      rows.forEach(row => tbody.appendChild(row));
    }

    // ===== API CALLS ===== 
    async function fetchQuote(sym) {
      if(HARDCODED_PRICES[sym.toUpperCase()]) {
        const hc = HARDCODED_PRICES[sym.toUpperCase()];
        return {c: hc.price, d: hc.change, dp: hc.changePct, note: hc.note};
      }

      const ticker = TICKER_MAP[sym.toUpperCase()] || null;
      const attempts = ticker ? [{t: ticker}] : [{t: `${sym}.BO`}, {t: `${sym}.NS`}];
      
      for(const {t} of attempts) {
        try {
          const url = `https://api.allorigins.win/get?url=${encodeURIComponent(`https://query1.finance.yahoo.com/v8/finance/chart/${t}?interval=1d&range=1d`)}`;
          const res = await fetch(url);
          if(!res.ok) continue;
          const data = JSON.parse((await res.json()).contents);
          const meta = data?.chart?.result?.[0]?.meta;
          if(!meta?.regularMarketPrice) continue;
          const price = meta.regularMarketPrice;
          const prevClose = meta.chartPreviousClose || meta.previousClose || price;
          const change = price - prevClose;
          return {c: price, d: change, dp: prevClose > 0 ? (change/prevClose)*100 : 0};
        } catch(e) { continue; }
      }
      return null;
    }

    // ===== CHARTS ===== 
    let returnBarChart, allocDonutChart;
    
    function ensureReturnBar(symbols) {
      if(!returnBarChart) {
        returnBarChart = new Chart(document.getElementById('returnBarChart').getContext('2d'), {
          type: 'bar',
          data: {labels: symbols, datasets: [{label: 'Overall Return (₹)', data: [], backgroundColor: [], barPercentage: 0.6, borderRadius: 6}]},
          options: {responsive: true, maintainAspectRatio: false, animation: {duration: 800, easing: 'easeInOutQuart'}, indexAxis: 'y', scales: {x: {ticks: {color:'#ccc'}, grid: {color:'rgba(255,255,255,0.08)'}}, y: {ticks: {color:'#ccc'}, grid: {color:'rgba(255,255,255,0.08)'}}}, plugins: {legend: {labels: {color: '#fff'}}}}
        });
      }
    }

    function updateReturnBars(symbols, returnMap) {
      const data = symbols.map(s=> returnMap[s] ?? 0);
      returnBarChart.data.labels = symbols;
      returnBarChart.data.datasets[0].data = data;
      returnBarChart.data.datasets[0].backgroundColor = data.map(v=> v>=0 ? '#31c920' : '#e33232');
      returnBarChart.update();
    }

    function ensureAllocDonut(symbols) {
      if(!allocDonutChart) {
        const ctx = document.getElementById('allocDonutChart').getContext('2d');
        const gradients = symbols.map(s => {
          const g = ctx.createLinearGradient(0, 0, 0, 400);
          const c = SYMBOL_COLORS[s] || '#888';
          g.addColorStop(0, c);
          g.addColorStop(1, c + '80');
          return g;
        });

        allocDonutChart = new Chart(ctx, {
          type: 'doughnut',
          data: {labels: symbols, datasets: [{label: '% of Portfolio', data: [], backgroundColor: gradients, borderColor: 'rgba(26,26,26,0.8)', borderWidth: 2, hoverOffset: 15}]},
          options: {responsive: true, maintainAspectRatio: false, cutout: '65%', animation: {duration: 1200, easing: 'easeInOutQuart'}, plugins: {legend: {display: true, position: 'right', labels: {color: '#fff', font: {size: 11}, padding: 12, usePointStyle: true}}, tooltip: {backgroundColor: 'rgba(0,0,0,0.9)', padding: 12, callbacks: {label: (ctx) => `${ctx.label}: ${(ctx.raw*100).toFixed(2)}%`}}}},
          plugins: [{
            id: 'centerText',
            afterDraw(chart) {
              const {ctx, chartArea} = chart;
              if(!chartArea) return;
              const cx = (chartArea.left + chartArea.right)/2;
              const cy = (chartArea.top + chartArea.bottom)/2;
              ctx.save();
              ctx.textAlign = 'center';
              ctx.textBaseline = 'middle';
              ctx.fillStyle = '#fff';
              ctx.font = '600 20px Inter';
              ctx.fillText(document.getElementById('totalValue').textContent, cx, cy - 10);
              ctx.fillStyle = document.getElementById('returnAmount').textContent.includes('-') ? '#e33232' : '#31c920';
              ctx.font = '700 14px Inter';
              ctx.fillText(document.getElementById('returnPercentage').textContent, cx, cy + 18);
              ctx.restore();
            }
          }]
        });
      }
    }

    function updateAllocDonut(symbols, rows) {
      const vals = symbols.map(s=> parseMoney(rows[s].textContent));
      const total = vals.reduce((a,b)=>a+b,0);
      const weights = total > 0 ? vals.map(v=> v/total) : vals.map(()=>0);
      allocDonutChart.data.datasets[0].data = weights;
      allocDonutChart.update();
    }

    // ===== MAIN REFRESH FUNCTION ===== 
    async function refreshAll() {
      setStatus("Fetching stock prices...", '');
      const tbody = document.getElementById('tbody');
      const rows = {};
      tbody.querySelectorAll('tr').forEach((tr, i) => {
        rows[tr.cells[0].textContent.trim().toUpperCase()] = tr.cells;
      });

      const symbols = PORTFOLIO.map(s=>s.symbol.toUpperCase());
      ensureReturnBar(symbols);
      ensureAllocDonut(symbols);

      let updated = 0;
      const returns = {};

      for(const stock of PORTFOLIO) {
        const cells = rows[stock.symbol.toUpperCase()];
        if(!cells) continue;

        const q = await fetchQuote(stock.symbol);
        if(!q) {
          cells[1].textContent = "—";
          cells[2].textContent = "No data";
          await new Promise(r => setTimeout(r, 500));
          continue;
        }

        cells[1].textContent = fmtMoney(q.c);
        if(q.note) {
          cells[2].textContent = q.note;
          cells[2].className = 'suspended';
        } else {
          cells[2].textContent = fmtSignedMoney(q.d) + ' (' + fmtPct(q.dp) + ')';
          cells[2].className = q.dp >= 0 ? 'positive-return' : 'negative-return';
        }

        const currentValue = q.c * stock.qty;
        const overallReturn = (q.c - stock.avgCost) * stock.qty;
        const overallPct = (overallReturn / (stock.avgCost * stock.qty)) * 100;

        cells[3].textContent = fmtMoney(currentValue);
        cells[4].textContent = fmtSignedMoney(overallReturn) + ' (' + fmtPct(overallPct) + ')';
        cells[4].className = overallReturn >= 0 ? 'positive-return' : 'negative-return';

        returns[stock.symbol.toUpperCase()] = overallReturn;
        updated++;
        setStatus(`Fetching… (${updated}/${PORTFOLIO.length})`, '');
        await new Promise(r => setTimeout(r, 500));
      }

      let totalInv = 0, totalVal = 0;
      PORTFOLIO.forEach(s => {
        totalInv += s.avgCost * s.qty;
        totalVal += parseMoney(rows[s.symbol.toUpperCase()][3].textContent);
      });

      const totalRet = totalVal - totalInv;
      const avgRet = totalInv > 0 ? (totalRet/totalInv)*100 : 0;

      document.getElementById('totalValue').textContent = fmtMoney(totalVal);
      document.getElementById('totalValueNote').textContent = fmtSignedMoney(totalRet);
      document.getElementById('totalInvested').textContent = fmtMoney(totalInv);
      document.getElementById('returnAmount').textContent = fmtSignedMoney(totalRet);
      document.getElementById('returnPercentage').textContent = fmtPct(avgRet);
      document.getElementById('averageReturn').textContent = fmtPct(avgRet);
      document.getElementById('positionsCount').textContent = updated;
      updatedTimeEl.textContent = new Date().toLocaleTimeString();

      setStatus(`✓ Updated ${updated}/${PORTFOLIO.length} stocks`, 'success');

      updateReturnBars(symbols, returns);
      updateAllocDonut(symbols, Array.from(tbody.querySelectorAll('tr')).map(r => r.cells[3]));
    }

    // ===== INITIALIZE APP ===== 
    document.addEventListener("DOMContentLoaded", () => {
      initializeTable();
      refreshAll();
      setInterval(refreshAll, REFRESH_MS);
      if(refreshBtn) refreshBtn.addEventListener("click", refreshAll);
    });
  </script>
</body>
</html>
